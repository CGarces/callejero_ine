<div class="container py-5">
  <h1 class="mb-4">{{ title() }}</h1>

  <!-- Chained Selects Area -->
  <div class="card mb-4">
    <div class="card-header">
      <h2 class="h5 mb-0">Selección por Jerarquía</h2>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <!-- Autonomía -->
        <div class="col-md-4">
          <label for="autonomia" class="form-label">Comunidad Autónoma</label>
          <select id="autonomia" class="form-select" [value]="selectedAutonomia()"
            (change)="selectedAutonomia.set($any($event.target).value); onAutonomiaChange()">
            <option value="">Seleccione...</option>
            @for (auto of autonomias(); track auto.CCOM) {
            <option [value]="auto.CCOM">{{ auto.AUTO }}</option>
            }
          </select>
        </div>

        <!-- Provincia -->
        <div class="col-md-4">
          <label for="provincia" class="form-label">Provincia</label>
          <select id="provincia" class="form-select" [value]="selectedProvincia()"
            [disabled]="provincias().length === 0"
            (change)="selectedProvincia.set($any($event.target).value); onProvinciaChange()">
            <option value="">Seleccione...</option>
            @for (prov of provincias(); track prov.CODPRO) {
            <option [value]="prov.CODPRO">{{ prov.PRO }}</option>
            }
          </select>
        </div>

        <!-- Población -->
        <div class="col-md-4">
          <label for="poblacion" class="form-label">Población</label>
          <select id="poblacion" class="form-select" [value]="selectedPoblacion()"
            [disabled]="poblaciones().length === 0" (change)="selectedPoblacion.set($any($event.target).value)">
            <option value="">Seleccione...</option>
            @for (pob of poblaciones(); track pob.cmun + '-' + pob.cun) {
            <option [value]="pob.cmun + '-' + pob.cun">{{ pob.nentsic }}</option>
            }
          </select>
        </div>
      </div>

      @if (selectedPoblacion()) {
      <div class="alert alert-success mt-3 mb-0">
        <ul>
          <li>
            <strong>CCOM ({{selectedAutonomia()}}):</strong> Codigo de la Comunidad Autónoma seleccionada
          </li>
          <li>
            <strong>CPRO ({{selectedProvincia()}}):</strong> Código de la Provincia seleccionada
          </li>
          <li>
            <strong>CMUN - CUN ({{ selectedPoblacion() }}):</strong> Código de municipio y código de unidad poblacional
            seleccionados
          </li>
        </ul>
      </div>
      }
    </div>
  </div>

  <!-- Via Search Area -->
  <div class="card">
    <div class="card-header">
      <h2 class="h5 mb-0">Búsqueda de Vías por código postal</h2>
    </div>
    <div class="card-body">
      <div class="row g-3 mb-3">
        <div class="col-md-4">
          <label for="codigoPostal" class="form-label">Código Postal</label>
          <input type="text" id="codigoPostal" class="form-control" placeholder="Ej: 28001" maxlength="5"
            [value]="codigoPostal()" (input)="codigoPostal.set($any($event.target).value)">
          <div class="form-text">Mínimo 5 dígitos</div>
        </div>

        <div class="col-md-4">
          <label for="viaNombre" class="form-label">Nombre de Vía</label>
          <input type="text" id="viaNombre" class="form-control" placeholder="Ej: Mayor" [value]="viaNombre()"
            (input)="viaNombre.set($any($event.target).value)">
          <div class="form-text">Mínimo 3 caracteres</div>
        </div>

        <div class="col-md-4 d-flex align-items-end">
          <button type="button" class="btn btn-primary w-100" [disabled]="!canSearchVias() || viasLoading()"
            (click)="searchVias()">
            @if (viasLoading()) {
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            Buscando...
            } @else {
            Buscar Vías
            }
          </button>
        </div>
      </div>

      @if (viasError()) {
      <div class="alert alert-danger">
        {{ viasError() }}
      </div>
      }

      @if (vias().length > 0) {
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>CP</th>
              <th>Entidad</th>
              <th>Tipo</th>
              <th>Nombre de Vía</th>
            </tr>
          </thead>
          <tbody>
            @for (via of vias(); track via.cpos + '-' + via.cvia) {
            <tr>
              <td>{{ via.cpos }}</td>
              <td>{{ via.nentsic }}</td>
              <td>{{ via.tvia }}</td>
              <td>{{ via.nvia }}</td>
            </tr>
            }
          </tbody>
        </table>
        <div class="text-muted">
          {{ vias().length }} resultado(s) encontrado(s)
        </div>
      </div>
      }
    </div>
  </div>
</div>

<router-outlet />